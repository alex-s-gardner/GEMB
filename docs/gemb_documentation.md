# gemb documentation
`gemb` returns a center coordinates from GEMB column spacings. 

# Syntax 
```matlab
OutData = gemb(Profile, ClimateForcing, ModelParam)
OutData = gemb(..., verbose=true)
OutData = gemb(..., display_waitbar=false)
```

# Description
`OutData = gemb(Profile, ClimateForcing, ModelParam)` produces time series of snow, firn, and ice properties OutData from input vectors of the initial column `Profile` generated by [`model_initialize_column`](model_initialize_column_documentation.md). Input `ClimateForcing` is a structure containing time series of surface forcing parameters descibed below. Input `ModelParam` is from the function [`model_initialize_parameters`](model_initialize_parameters_documentation.md). 

`OutData = gemb(..., verbose=true)` turns on additional checks to ensure the model conserves mass and energy for every timestep and logs the results. Note: the verbose=true option may add ~10% to total processing time. 

`OutData = gemb(..., display_waitbar=false)` disables the graphical waitbar. 

### Inputs 
For additional information about variables, see the [GEMB variables page](GEMB_variables.md).

| Input | Units | Description
|-------|-------|-------------|
|**`Profile`** | table |  `Profile` generated by [`model_initialize_column`](model_initialize_column_documentation.md).|
|`Profile.temperature`      | K     | Vector of initial layer temperatures |
|`Profile.dz`     | m     | Vector of initial layer thicknesses | 
|`Profile.density`      | kg m<sup>-2</sup> |        Vector of initial layer densities |
|`Profile.water`      | m     | Vector of initial layer water content |
|`Profile.grain_radius`     | mm     | Vector of initial grain sizes (effective radius) |
|`Profile.grain_dendricity`    |  fraction     | Vector of initial grain dendricity (0-1) |
|`Profile.grain_sphericity`    |  fraction | Vector of initial grain sphericity (0-1)|
|`Profile.albedo`      |  fraction  | Initial surface albedo (0-1) |
|`Profile.albedo_diffuse`| fraction | Initial diffuse albedo accumulator |
|**`ClimateForcing`** | structure | Structure containing time-series meteorological data|
| `ClimateForcing.time`      | datetime   |  Time vector|
| `ClimateForcing.shortwave_downward`       | W m<sup>-2</sup>    |  Downward shortwave radiation|
| `ClimateForcing.longwave_downward`       | W m<sup>-2</sup>    |  Downward longwave radiation|
| `ClimateForcing.temperature_air`    | K          |  Air temperature|
| `ClimateForcing.pressure_air`    | Pa         | Air pressure|
| `ClimateForcing.relative_humidity`        | %          |  Relative humidity|
| `ClimateForcing.vapor_pressure`     | Pa         |  Vapor pressure|
| `ClimateForcing.wind_speed`         | m s<sup>-1</sup>     |  Wind speed|
| `ClimateForcing.precipitation`         | kg m<sup>-2</sup>    |  Precipitation |
| `ClimateForcing.wind_observation_height`     |   m         |  Height above the surface where wind is measured or modeled.   | 
| `ClimateForcing.temperature_observation_height` |    m        |  Height above the surface where temperature is measured or modeled.   |  
| `ClimateForcing.temperature_air_mean` |     K       |  Climatological mean temperature   |  
| `ClimateForcing.wind_speed_mean`     |  s<sup>-1</sup>  | Climatological mean wind speed   |  
| `ClimateForcing.precipitation_mean`     |  kg m<sup>-2</sup>  |  Climatologial mean precipitation per time step   |  
|**`ModelParam`** | structure   | Structure generated by [`model_initialize_parameters`](model_initialize_parameters_documentation.md) containing model configuration parameters|


### Outputs 
Outputs of the `gemb` function are packaged into an `OutData` structure whose variables dimensions are 1xN for single-level timeseries like air temperature and firn air content, or MxN for full-column timeseries whose dimensions correspond to M depth levels and N output timesteps (which may be different from the input timesteps if `ModelParam.output_frequency` is not `"all"`.

| Output | Description
|-------|-------------|
|**`OutData`** | Structure containing ouput time series.|
| `OutData.time` | 1xN time in datetime format |
| `OutData.melt`  | 1xN Time series of melt mass. |
| `OutData.runoff`  | 1xN Time series of runoff mass. |
| `OutData.refreeze` | 1xN Time series of refrozen mass. |
| `OutData.evaporation_condensation` | 1xN Time series of cumulative mass of evaporation (positive) or condensation (negative). |
| `OutData.shortwave_net` | 1xN Time series of net shortwave radiation |
| `OutData.longwave_net` | 1xN Time series of net longwave radiation |
| `OutData.heat_flux_sensible` | 1xN Time series of sensible heat flux |
| `OutData.heat_flux_latent` | 1xN Time series of latent heat flux |
| `OutData.albedo_surface` | 1xN Time series of surface albedo.  |
| `OutData.valid_profile_length` | 1xN Time series of vertical profile length at the instant in time it was saved as output. |
| `OutData.densification_from_compaction` | 1xN Time series of compaction due to densification. |
| `OutData.densification_from_melt` | 1xN Time series of compaction due to melt. |
| `OutData.temperature_air` | 1xN Time series of surface air temperature forcing (averaged per output timestep if the `ModelParam.output_frequency` is lower than the frequency of the input forcing data. |
| `OutData.precipitation` | 1xN Time series of precipitation forcing (summed per output timestep if the `ModelParam.output_frequency` is lower than the frequency of the input forcing data. |
| `OutData.temperature` | MxN Time series of column temperature. |
| `OutData.dz` | MxN Time series of column vertical spacing. |
| `OutData.density` | MxN Time series of column density. |
| `OutData.water` | MxN Time series of column water content. |
| `OutData.grain_radius` | MxN Time series of column grain radius. |
| `OutData.grain_dendricity` | MxN Time series of column grain dendricity. |
| `OutData.grain_sphericity` | MxN Time series of column grain sphericity. |
| `OutData.albedo` | MxN Time series of column albedo. Currently, this is only used if `ModelParam.albedo_method="BougamontBamber"` because by other methods, albedo is only a surface property (in which case, see `OutData.albedo_surface`. |
| `OutData.albedo_diffuse` | MxN Time series of column albedo for diffuse radiation. Currently, this is only used if `ModelParam.albedo_method="BougamontBamber"`.|
| `OutData.rain` | 1xN Time series of rain mass. |
| `OutData.mass_added` | 1xN Time series of mass added (positive) or removed (negative) by `manage_layers`. |
| `OutData.firn_air_content` | 1xN Time series of total height of all air in the firn column. |

# Climate Forcing template 

Here is a blank template for a Climate Forcing structure `CF`, containing all 13 climate forcing variables that are required to run `gemb`: 

```matlab
CF.time                           = ; % datetime
CF.temperature_air                = ; % K 
CF.pressure_air                   = ; % Pa
CF.precipitation                  = ; % kg m^-2
CF.wind_speed                     = ; % m s^-1
CF.shortwave_downward             = ; % W m^-2
CF.longwave_downward              = ; % W m^-2
CF.vapor_pressure                 = ; % Pa
CF.temperature_air_mean           = ; % K
CF.wind_speed_mean                = ; % m s^-1
CF.precipitation_mean             = ; % kg m^-2
CF.temperature_observation_height = ; % m
CF.wind_observation_height        = ; % m
```

# Example
Run a basic example. 

```matlab
% Initialize model parameters:
ModelParam = model_initialize_parameters(output_frequency="daily");

% Generate sample data: 
time_step_hours = 3;
ClimateForcing = simulate_climate_forcing("test_1", time_step_hours);

% Initialize grid:
Profile = model_initialize_column(ModelParam, ClimateForcing);

% Run GEMB: 
OutData = gemb(Profile, ClimateForcing, ModelParam);
```

# Author Information
The Glacier Energy and Mass Balance (GEMB) was created by Alex Gardner, with contributions from Nicole-Jeanne Schlegel and Chad Greene. Complete code and documentation are available at [https://github.com/alex-s-gardner/GEMB](https://github.com/alex-s-gardner/GEMB). Please cite any use of GEMB as:

Gardner, A. S., Schlegel, N.-J., and Larour, E.: Glacier Energy and Mass Balance (GEMB): a model of firn processes for cryosphere research, Geosci. Model Dev., 16, 2277â€“2302, [https://doi.org/10.5194/gmd-16-2277-2023](https://doi.org/10.5194/gmd-16-2277-2023), 2023. 
